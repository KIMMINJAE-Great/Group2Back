<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper
	namespace="com.dz.back.ace.ace1000.ace1010.mapper.ACE1010Mapper">
	<resultMap
		type="com.dz.back.ace.ace1000.ace1010.dto.AbizCarPersonDTO"
		id="abizcarpersonMap">
		<id property="co_cd" column="CO_CD" />
		<id property="seq_nb" column="SEQ_NB" />
		<id property="car_cd" column="CAR_CD" />
		<id property="use_dt" column="USE_DT" />
		<id property="emp_cd" column="EMP_CD" />
		<result property="start_time" column="START_TIME" />
		<result property="end_time" column="END_TIME" />
		<result property="dept_cd" column="DEPT_CD" />
		<result property="use_fg" column="USE_FG" />
		<result property="start_fg" column="START_FG" />
		<result property="start_addr" column="START_ADDR" />
		<result property="start_addr1" column="START_ADDR1" />
		<result property="end_fg" column="END_FG" />
		<result property="end_addr" column="END_ADDR" />
		<result property="end_addr1" column="END_ADDR1" />
		<result property="mileage_km" column="MILEAGE_KM" />
		<result property="before_km" column="BEFORE_KM" />
		<result property="after_km" column="AFTER_KM" />
		<result property="send_yn" column="SEND_YN" />
		<result property="insert_id" column="INSERT_ID" />
		<result property="insert_ip" column="INSERT_IP" />
		<result property="insert_dt" column="INSERT_DT" />
		<result property="modify_id" column="MODIFY_ID" />
		<result property="modify_ip" column="MODIFY_IP" />
		<result property="modify_dt" column="MODIFY_DT" />
		<result property="data_fg" column="DATA_FG" />
	</resultMap>

	<select id="getallcars" resultMap="abizcarpersonMap">
		select
		abizcarperon.co_cd,
		abizcarperon.seq_nb,
		abizcarperon.car_cd,
		abizcarperon.use_dt,
		abizcarperon.emp_cd,
		abizcarperon.start_time,
		abizcarperon.end_time,
		abizcarperon.dept_cd,
		abizcarperon.use_fg,
		abizcarperon.start_fg,
		abizcarperon.start_addr,
		abizcarperon.start_addr1,
		abizcarperon.end_fg,
		abizcarperon.end_addr,
		abizcarperon.end_addr1,
		abizcarperon.mileage_km,
		abizcarperon.before_km,
		abizcarperon.after_km,
		abizcarperon.send_yn,
		abizcarperon.insert_id,
		abizcarperon.insert_ip,
		abizcarperon.modify_id,
		abizcarperon.modify_ip,
		abizcarperon.modify_dt,
		abizcarperon.data_fg
		from abizcar_person as abizcarperon
	</select>
	
	<select id="findallbycar" resultMap="abizcarpersonMap">
	SELECT
		abizcarperon.co_cd,
		abizcarperon.seq_nb,
		abizcarperon.car_cd,
		abizcarperon.use_dt,
		abizcarperon.emp_cd,
		abizcarperon.start_time,
		abizcarperon.end_time,
		abizcarperon.dept_cd,
		abizcarperon.use_fg,
		abizcarperon.start_fg,
		abizcarperon.start_addr,
		abizcarperon.start_addr1,
		abizcarperon.end_fg,
		abizcarperon.end_addr,
		abizcarperon.end_addr1,
		abizcarperon.mileage_km,
		abizcarperon.before_km,
		abizcarperon.after_km,
		abizcarperon.send_yn,
		abizcarperon.insert_id,
		abizcarperon.insert_ip,
		abizcarperon.modify_id,
		abizcarperon.modify_ip,
		abizcarperon.modify_dt,
		abizcarperon.data_fg
		from abizcar_person as abizcarperon
		WHERE abizcarperon.car_cd = #{car_cd}
	</select>
	
	<!-- 운행 구분 -->
	<resultMap
		type="com.dz.back.ace.ace1000.ace1010.dto.UseFgDTO" id="UseFgDTO">
		<id property="d_id" column="D_ID" />
		<id property="d_nm" column="D_NM" />
	</resultMap>

	<select id="usefg" resultMap="UseFgDTO">
		SELECT usefg.D_ID, usefg.D_NM FROM
		sctrl_d as usefg
	</select>
	<!-- 출발 도착구분 -->
	<resultMap
		type="com.dz.back.ace.ace1000.ace1010.dto.StartEndFgDTO" id="StartEndFgDTO">
		<id property="p_id" column="P_ID" />
		<id property="p_nm" column="P_NM" />
	</resultMap>

	<select id="startendfg" resultMap="StartEndFgDTO">
		SELECT startendfg.P_ID, startendfg.P_NM FROM
		sctrl_p as startendfg
	</select>
	<!-- 마감 유무 -->
	<resultMap
		type="com.dz.back.ace.ace1000.ace1010.dto.SendYnDTO" id="SendYnDTO">
		<id property="s_id" column="S_ID" />
		<id property="s_nm" column="S_NM" />
	</resultMap>

	<select id="sendyn" resultMap="SendYnDTO">
		SELECT sendyn.S_ID, sendyn.S_NM FROM
		sctrl_s as sendyn
	</select>

<!-- 운행기록부 한 행 저장-->
<insert id="insertAbizCarPerson" parameterType="com.dz.back.ace.ace1000.ace1010.dto.AbizCarPersonDTO" >
	INSERT INTO
	abizcar_person
	(
	CO_CD,
		SEQ_NB,
		CAR_CD,
		USE_DT,
		EMP_CD,
		START_TIME,
		END_TIME,
		DEPT_CD,
		USE_FG,
		START_FG,
		START_ADDR,
		START_ADDR1,
		END_FG,
		END_ADDR,
		END_ADDR1,
		MILEAGE_KM,
		BEFORE_KM,
		AFTER_KM,
		SEND_YN,
		INSERT_ID,
		INSERT_IP,
		INSERT_DT,
		MODIFY_ID,
		MODIFY_IP,
		MODIFY_DT
		
	) VALUES (
		#{co_cd},
		#{seq_nb},
		#{car_cd},
		#{use_dt},
		#{emp_cd},
		#{start_time},
		#{end_time},
		#{dept_cd},
		#{use_fg},
		#{start_fg},
		#{start_addr},
		#{start_addr1},
		#{end_fg},
		#{end_addr},
		#{end_addr1},
		#{mileage_km},
		#{before_km},
		#{after_km},
		#{send_yn},
		#{insert_id},
		#{insert_ip},
		#{insert_dt},
		#{modify_id},
		#{modify_ip},
		#{modify_dt}
		
	)

</insert>

<!-- 차량의 최대 seq_nm 찾기 -->
<select id="findMaxSeqNb"  parameterType="String" resultType="Integer"> 
	SELECT COALESCE(Max(seq_nb),0) FROM abizcar_person WHERE car_cd = #{car_cd}
	

</select>

</mapper>