<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper
	namespace="com.dz.back.ace.ace1000.ace1010.mapper.ACE1010Mapper">
	<resultMap
		type="com.dz.back.ace.ace1000.ace1010.dto.AbizCarPersonDTO"
		id="abizcarpersonMap">
		<id property="co_cd" column="CO_CD" />
		<id property="seq_nb" column="SEQ_NB" />
		<id property="car_cd" column="CAR_CD" />
		<id property="use_dt" column="USE_DT" />
		<id property="emp_cd" column="EMP_CD" />
		
		<result property="rmk_dc" column="RMK_DC" />
		<result property="start_time" column="START_TIME" />
		<result property="end_time" column="END_TIME" />
		<result property="dept_cd" column="DEPT_CD" />
		<result property="use_fg" column="USE_FG" />
		<result property="start_fg" column="START_FG" />
		<result property="start_addr" column="START_ADDR" />
		<result property="start_addr1" column="START_ADDR1" />
		<result property="end_fg" column="END_FG" />
		<result property="end_addr" column="END_ADDR" />
		<result property="end_addr1" column="END_ADDR1" />
		<result property="mileage_km" column="MILEAGE_KM" />
		<result property="before_km" column="BEFORE_KM" />
		<result property="after_km" column="AFTER_KM" />
		<result property="send_yn" column="SEND_YN" />
		<result property="insert_id" column="INSERT_ID" />
		<result property="insert_ip" column="INSERT_IP" />
		<result property="insert_dt" column="INSERT_DT" />
		<result property="modify_id" column="MODIFY_ID" />
		<result property="modify_ip" column="MODIFY_IP" />
		<result property="modify_dt" column="MODIFY_DT" />
		<result property="data_fg" column="DATA_FG" />
	</resultMap>

	<select id="getallcars" resultMap="abizcarpersonMap">
		select
		abizcarperson.co_cd,
		abizcarperson.seq_nb,
		abizcarperson.car_cd,
		abizcarperson.use_dt,
		abizcarperson.emp_cd,
		abizcarperson.start_time,
		abizcarperson.end_time,
		abizcarperson.dept_cd,
		abizcarperson.use_fg,
		abizcarperson.start_fg,
		abizcarperson.start_addr,
		abizcarperson.start_addr1,
		abizcarperson.end_fg,
		abizcarperson.end_addr,
		abizcarperson.end_addr1,
		abizcarperson.mileage_km,
		abizcarperson.before_km,
		abizcarperson.after_km,
		abizcarperson.send_yn,
		abizcarperson.insert_id,
		abizcarperson.insert_ip,
		abizcarperson.modify_id,
		abizcarperson.modify_ip,
		abizcarperson.modify_dt,
		abizcarperson.data_fg
		from abizcar_person as abizcarperson
	</select>
	
	<select id="findallbycar" resultMap="abizcarpersonMap">
	SELECT
		abizcarperson.co_cd,
		abizcarperson.seq_nb,
		abizcarperson.car_cd,
		abizcarperson.use_dt,
		abizcarperson.emp_cd,
		abizcarperson.start_time,
		abizcarperson.end_time,
		abizcarperson.dept_cd,
		abizcarperson.use_fg,
		abizcarperson.start_fg,
		abizcarperson.start_addr,
		abizcarperson.start_addr1,
		abizcarperson.end_fg,
		abizcarperson.end_addr,
		abizcarperson.end_addr1,
		abizcarperson.mileage_km,
		abizcarperson.before_km,
		abizcarperson.after_km,
		abizcarperson.send_yn,
		abizcarperson.insert_id,
		abizcarperson.insert_ip,
		abizcarperson.modify_id,
		abizcarperson.modify_ip,
		abizcarperson.modify_dt,
		abizcarperson.rmk_dc,
		abizcarperson.data_fg
		from abizcar_person as abizcarperson
		WHERE abizcarperson.car_cd = #{car_cd}
		
		ORDER BY abizcarperson.use_dt ASC, abizcarperson.start_time ASC
	</select>
	
	<!-- 운행 구분 -->
	<resultMap
		type="com.dz.back.ace.ace1000.ace1010.dto.UseFgDTO" id="UseFgDTO">
		<id property="d_id" column="D_ID" />
		<id property="d_nm" column="D_NM" />
	</resultMap>

	<select id="usefg" resultMap="UseFgDTO">
		SELECT usefg.D_ID, usefg.D_NM FROM
		sctrl_d as usefg
	</select>
	<!-- 출발 도착구분 -->
	<resultMap
		type="com.dz.back.ace.ace1000.ace1010.dto.StartEndFgDTO" id="StartEndFgDTO">
		<id property="p_id" column="P_ID" />
		<id property="p_nm" column="P_NM" />
	</resultMap>

	<select id="startendfg" resultMap="StartEndFgDTO">
		SELECT startendfg.P_ID, startendfg.P_NM FROM
		sctrl_p as startendfg
	</select>
	<!-- 마감 유무 -->
	<resultMap
		type="com.dz.back.ace.ace1000.ace1010.dto.SendYnDTO" id="SendYnDTO">
		<id property="s_id" column="S_ID" />
		<id property="s_nm" column="S_NM" />
	</resultMap>

	<select id="sendyn" resultMap="SendYnDTO">
		SELECT sendyn.S_ID, sendyn.S_NM FROM
		sctrl_s as sendyn
	</select>

<!-- 운행기록부 한 행 저장-->
<insert id="insertAbizCarPerson" parameterType="com.dz.back.ace.ace1000.ace1010.dto.AbizCarPersonDTO" >
	INSERT INTO
	abizcar_person
	(
	CO_CD,
		SEQ_NB,
		CAR_CD,
		USE_DT,
		EMP_CD,
		START_TIME,
		END_TIME,
		DEPT_CD,
		USE_FG,
		START_FG,
		START_ADDR,
		START_ADDR1,
		END_FG,
		END_ADDR,
		END_ADDR1,
		MILEAGE_KM,
		BEFORE_KM,
		AFTER_KM,
		SEND_YN,
		INSERT_ID,
		INSERT_IP,
		INSERT_DT,
		MODIFY_ID,
		MODIFY_IP,
		MODIFY_DT,
		RMK_DC
		
	) VALUES (
		#{co_cd},
		#{seq_nb},
		#{car_cd},
		#{use_dt},
		#{emp_cd},
		#{start_time},
		#{end_time},
		#{dept_cd},
		#{use_fg},
		#{start_fg},
		#{start_addr},
		#{start_addr1},
		#{end_fg},
		#{end_addr},
		#{end_addr1},
		#{mileage_km},
		#{before_km},
		#{after_km},
		#{send_yn},
		#{insert_id},
		#{insert_ip},
		#{insert_dt},
		#{modify_id},
		#{modify_ip},
		#{modify_dt},
		#{rmk_dc}
		
	)

</insert>

<!-- 운행기록부 한 행 저장-->
<update id="updateAbizCarPerson" parameterType="com.dz.back.ace.ace1000.ace1010.dto.AbizCarPersonDTO" >
	UPDATE abizcar_person SET
	
		CO_CD = #{co_cd},
		SEQ_NB = #{seq_nb},
		CAR_CD = #{car_cd},
		USE_DT = #{use_dt},
		EMP_CD = #{emp_cd},
		START_TIME = #{start_time},
		END_TIME = #{end_time},
		DEPT_CD = #{dept_cd},
		USE_FG = #{use_fg},
		START_FG = #{start_fg},
		START_ADDR = #{start_addr},
		START_ADDR1 = #{start_addr1},
		END_FG = #{end_fg},
		END_ADDR = #{end_addr},
		END_ADDR1 = #{end_addr1},
		MILEAGE_KM = #{mileage_km},
		BEFORE_KM = #{before_km},
		AFTER_KM = #{after_km},
		SEND_YN = #{send_yn},
		MODIFY_ID = #{modify_id},
		MODIFY_IP = #{modify_ip},
		MODIFY_DT= #{modify_dt},
		RMK_DC = #{rmk_dc}
		
	WHERE SEQ_NB = #{seq_nb} AND CAR_CD = #{car_cd}

</update>

<!-- 차량의 최대 seq_nm 찾기 -->
<select id="findMaxSeqNb"  parameterType="String" resultType="Integer"> 
	SELECT COALESCE(Max(seq_nb),0) FROM abizcar_person WHERE car_cd = #{car_cd}
	

</select>

</mapper>